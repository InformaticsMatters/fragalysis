docker run -p 5432:5432 -e POSTGRES_PASSWORD=hello -v /home/timbo/fmolsdata:/var/lib/postgresql/data:Z --name fairmoleculesdb --shm-size=5g postgres:11 -c 'shared_buffers=4GB'

docker run -d -p 5432:5432 -e POSTGRES_PASSWORD=hello -v /pgdata:/var/lib/postgresql/data:Z -v /pgwal:/var/lib/postgresql/data/pg_wal:Z --name fairmoleculesdb --shm-size=9g informaticsmatters/rdkit-cartridge-debian:Release_2019_09_2 -c 'shared_buffers=8GB'

# postgres
#create database fairmolecules encoding 'LATIN1' LC_COLLATE 'C' LC_CTYPE 'C' TEMPLATE template0;
create database fairmolecules;

export FM_DB_URL=postgresql://username:password@localhost:5432/fairmolecules
conda activate fairmols


python -m db.fairmolecules --list-sources

python -m db.fairmolecules -d -c --source-name chembl --source-version 25
python -m db.fairmolecules --source-name chemspace-bb --source-version 2019-07
python -m db.fairmolecules --source-name chemspace-bb --source-version 2019-12 --source-currency USD
python -m db.fairmolecules --source-name molport --source-version 2019-12 --source-currency USD
python -m db.fairmolecules --source-name molport --source-version 2020-01 --source-currency USD
python -m db.fairmolecules --source-name dsip --source-version 1


time python -m frag.network.scripts.standardise_chembl_compounds_3 -i ~/data/chembl_25.sdf.gz -s 1
time python -m frag.network.scripts.standardise_chemspace_bb_compounds_3-0 -s 2 -i ~/data/chemspace/2019-07/chemspace-bb_01.txt.gz
time python -m frag.network.scripts.standardise_chemspace_bb_compounds_3-1 -s 3 -i ~/data/chemspace/2019-12/chemspace-bb_00.txt.gz
time python -m frag.network.scripts.standardise_molport_compounds_3 -s 4 -i ~/data/molport/2019-12/iis_smiles-000-000-000--000-499-999.txt.gz
time python -m frag.network.scripts.standardise_xchem_compounds_3 -s 6 -i ~/data/xchem/dsip.txt.gz


conda activate fairmols && time python -m frag.network.scripts.standardise_chemspace_bb_compounds_3-0  -s 2 -i ~/data/chemspace/2019-07/chemspace-bb_01.txt.gz

conda activate fairmols && time python -m frag.network.scripts.standardise_molport_compounds_3 -s 4 -i ~/data/molport/2019-12/iis_smiles-00
conda activate fairmols && time python -m frag.network.scripts.standardise_molport_compounds_3 -s 5 -i ~/data/molport/2020-01/iis_smiles-00


conda activate fairmols && time python -m db.fragmenter -l 50000 --hac-max 24
time python -m db.fragmenter -l 10000 --dump-cache

create index ix_nonisomol_smiles on nonisomol using hash (smiles);
alter table nonisomol add constraint c_nonisomol_smiles exclude using hash (smiles with =);

python -m frag.network.scripts.build_single --smiles 'CCc1nn(C)cc1Cn1c(S)nnc1C1CC1'


python -m frag.network.scripts.standardise_xchem_compounds ~/data/xchem dsip ~/data/xchem/standardised

python -m frag.network.scripts.standardise_chemspace_bb_pricing_compounds ~/data/chemspace/2019-12/ chemspace_bb2 ~/data/chemspace/2019-12/standardised